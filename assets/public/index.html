<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<title>GemGlobalB2B - API Status</title>

	<!-- Poppins font -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link
		href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
		rel="stylesheet">

	<!-- Bootstrap -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

	<!-- Animate css -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

	<!-- Custom style -->
	<link rel="stylesheet" href="style.css">
</head>

<body>
	<div id="root"></div>

	<!-- Bootstrap -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
		crossorigin="anonymous"></script>

	<!-- Moment.js -->
	<script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>

	<!-- React and ReactDOM -->
	<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
	<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

	<!-- Babel for JSX -->
	<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

	<script type="text/babel">
		function formatDate(dateStr) {
			const date = new Date(dateStr);

			const day = String(date.getDate()).padStart(2, '0');
			const month = date.toLocaleString('default', { month: 'short' });
			const year = date.getFullYear();

			let hours = date.getHours();
			const minutes = String(date.getMinutes()).padStart(2, '0');
			const seconds = String(date.getSeconds()).padStart(2, '0');

			const ampm = hours >= 12 ? 'PM' : 'AM';
			hours = hours % 12 || 12;
			const hourStr = String(hours).padStart(2, '0');

			return `${day} ${month} ${year} ${hourStr}:${minutes}:${seconds} ${ampm}`;
		}

		function formatMinutesToPretty(minutes) {
			if (typeof minutes !== 'number' || isNaN(minutes)) {
				return '';
			}
			const days = Math.floor(minutes / 1440);
			const hours = Math.floor((minutes % 1440) / 60);
			const remainingMinutes = minutes % 60;

			const parts = [];
			if (days > 0) parts.push(days + 'd');
			if (hours > 0) parts.push(hours + 'h');
			if (remainingMinutes > 0 && parts.length === 0) parts.push(remainingMinutes + 'm');
			if (parts.length === 0 && minutes === 0) return '0m';

			return parts.join(' ');
		}

		const APIStatus = () => {
			const [data, setData] = React.useState(null);

			React.useEffect(() => {
				fetch('/api/stats')
					.then(res => res.json())
					.then(d => {
						if (d.isSuccess) setData(d.data);
					})
					.catch(error => {
						console.error("Error fetching build info:", error);
						setData({ error: "Failed to load API status." });
					});
			}, []);

			return (
				<div className="container d-flex justify-content-center">
					<div className="card fade-in-animation" style={{ width: '700px' }}>

						{/* Loader */}
						{
							!data &&
							<div className="card-body position-relative d-flex flex-column align-items-center p-4" style={{ height: "250px" }}>
								<div className={`loader-container enter`}>
									<div>
										<img src="/images/logo.svg" alt="logo" />
										<div className="loader"></div>
									</div>
									<div className="fw-bold">Loading API status...</div>
								</div>
							</div>
						}

						{/* Error */}
						{
							data && data.error &&
							<div className="card-body d-flex flex-column align-items-center text-danger p-4">
								<i className="bi bi-exclamation-triangle-fill" style={{ height: "4rem", fontSize: "4rem" }}></i>
								<div className="mt-4">{data.error}</div>
							</div>
						}

						{/* Content */}
						{
							data && !data.error &&
							<>
								<div className={`ribbon ${data.environment !== "production" ? "bg-danger" : "bg-success"} show`}>{data.environment}</div>
								<div className="card-header">
									<div className="card-title d-flex flex-column align-items-center">
										<img style={{ width: '10rem', height: "5rem" }} src="/images/logo.svg" alt='logo' />
										<div className="mt-4 text-capitalize"> API is running</div>
									</div>
								</div>
								<div className="card-body">
									<table className="table table-borderless table-sm">
										<tbody>
											<tr>
												<th style={{ minWidth: "180px" }}>Build Version:</th>
												<td>{data.version}</td>
											</tr>
											<tr>
												<th style={{ minWidth: "180px" }}>Build Date:</th>
												<td>{formatDate(data.generatedAt)}</td>
											</tr>
											<tr>
												<th style={{ minWidth: "180px" }}>Allowed Domains:</th>
												<td>
													{data.allowedOrigins.map((x, index) => (
														<React.Fragment key={x}>
															<a href={x} target="_blank" rel="noopener noreferrer">{x}</a>
															{index < data.allowedOrigins.length - 1 && ', '}
														</React.Fragment>
													))}
												</td>
											</tr>
											<tr>
												<th style={{ minWidth: "180px" }}>API Timer:</th>
												<td>
													{data.apiTimeTrackingEnabled ?
														<><i className="bi bi-check-circle-fill text-success"></i><span className="ms-1 text-success">Enabled</span></> :
														<><i className="bi bi-x-circle-fill text-danger"></i><span className="ms-1 text-danger">Disbaled</span></>
													}
												</td>
											</tr>
											<tr>
												<th style={{ minWidth: "180px" }}>Operation Timer:</th>
												<td>
													{data.operationTimeTrackingEnabled ?
														<><i className="bi bi-check-circle-fill text-success"></i><span className="ms-1 text-success">Enabled</span></> :
														<><i className="bi bi-x-circle-fill text-danger"></i><span className="ms-1 text-danger">Disbaled</span></>
													}
												</td>
											</tr>
											<tr>
												<th style={{ minWidth: "180px" }}>Token Expiration:</th>
												<td>{formatMinutesToPretty(data.tokenExpirationMinutes)}</td>
											</tr>
											<tr>
												<th style={{ minWidth: "180px" }}>From Email:</th>
												<td>
													<a href={`mailto:${data.emailSentFrom}`} target="_blank" rel="noopener noreferrer">{data.emailSentFrom}</a>
												</td>
											</tr>
										</tbody>
									</table>
								</div>

								<div className="card-footer gap-2">
									<a className="btn btn-primary" href="/logs.html">
										<i className="bi-journal-text me-1"></i>
										Logs
									</a>
									<a className="btn btn-primary" href="/db.html">
										<i className="bi bi-database-fill me-1"></i>
										DB Stats
									</a>
									<a className="btn btn-outline-primary" href="/api-docs/" target="_blank" rel="noopener noreferrer">
										<i className="bi bi-book me-1"></i>
										API Docs
									</a>
								</div>
							</>
						}
					</div>
				</div>
			);
		};

		ReactDOM.createRoot(document.getElementById('root')).render(<APIStatus />);
	</script>
</body>

</html>